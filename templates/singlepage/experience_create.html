<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>경력 등록</title>
    <!-- Favicon-->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
    <!-- Font Awesome icons (free version)-->
    <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic"
          rel="stylesheet" type="text/css"/>
    <link rel="preconnect" href="https://fonts.gstatic.com"> 
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700&display=swap" rel="stylesheet">             
    <!-- Third party plugin CSS-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css"
          rel="stylesheet"/>
    <!-- Core theme CSS (includes Bootstrap)-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="{% static 'css/prostyle.css' %}" rel="stylesheet"/>
<!--    web3 연결, jquery연결-->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js" integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk=" crossorigin="anonymous"></script>


    <script>
    const abi = [
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "cid",
				"type": "address"
			}
		],
		"name": "newCareerCreated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "pid",
				"type": "address"
			}
		],
		"name": "newCertificationCreated",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"indexed": false,
				"internalType": "address",
				"name": "eid",
				"type": "address"
			}
		],
		"name": "newEducationCreated",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "careerList",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "job",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "compName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "content",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "startDate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "endDate",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "careeID",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "companyAddress",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "cidAvailable",
				"type": "bool"
			},
			{
				"internalType": "bool",
				"name": "companySignature",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "certificationList",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "certiName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "certiNumb",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "compName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "accDate",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "certiID",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "companyAddress",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "pidAvailable",
				"type": "bool"
			},
			{
				"internalType": "bool",
				"name": "companySignature",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "cidCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "cidList",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "compAddressList",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "companyCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "companyDetailList",
		"outputs": [
			{
				"internalType": "address",
				"name": "compAdress",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "compName",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "companyList",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_pid",
				"type": "address"
			}
		],
		"name": "companyRejectCaree",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_pid",
				"type": "address"
			}
		],
		"name": "companyRejectCerti",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_pid",
				"type": "address"
			}
		],
		"name": "companyRejectEdu",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_pid",
				"type": "address"
			}
		],
		"name": "companySignCaree",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_pid",
				"type": "address"
			}
		],
		"name": "companySignCerti",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_pid",
				"type": "address"
			}
		],
		"name": "companySignEdu",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "educationList",
		"outputs": [
			{
				"internalType": "string",
				"name": "name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "schoolName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "major",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "gpa",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "accDate",
				"type": "string"
			},
			{
				"internalType": "address",
				"name": "eduID",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "companyAddress",
				"type": "address"
			},
			{
				"internalType": "bool",
				"name": "eidAvailable",
				"type": "bool"
			},
			{
				"internalType": "bool",
				"name": "companySignature",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "eidCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "eidList",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getBalance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "pidCount",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"name": "pidList",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_job",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_compName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_content",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_startDate",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_endDate",
				"type": "string"
			}
		],
		"name": "setCareerData",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_certiName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_certiNumb",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_compName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_accDate",
				"type": "string"
			}
		],
		"name": "setCertificationData",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_compAddress",
				"type": "address"
			},
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			}
		],
		"name": "setCompany",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_schoolName",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_major",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_gpa",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_accDate",
				"type": "string"
			}
		],
		"name": "setEducationData",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
]

    const c_address = "0xED111aBCE5A36F48bed94B18a995D78B4069f1b5";
    window.web3 = new Web3(window.ethereum)
    web3 = window.web3
    contract = new web3.eth.Contract(abi,c_address)

    function waitForReceipt(hash, cb) {
        web3.eth.getTransactionReceipt(hash, function (err, receipt) {
          if (err) {
            error(err);
          }
          if (receipt !== null) {
            // Transaction went through
            if (cb) {
              cb(receipt);
            }
          } else {
            // Try again in 1 second
            window.setTimeout(function () {
              waitForReceipt(hash, cb);
            }, 1000);
          }
        });
      }

//FOR CHANGING PAGE


    function append(){

    let job=$("#job").val();
    let business=$("#business").val();
    let work=$("#work").val();
    let startDay = $("#startDay").val();
    let finishDay=$("#finishDay").val();

    if(job==''||business==''||work==''||startDay==''||finishDay==''){
        alert('모든 값을 작성하여주세요');
    }

    else{
        $("#rec_url").text("RECEIPT IS LOADING......")
        web3.eth.getAccounts(function get(err, res){
              account=res[0]
              console.log(account)
              transaction =
              ({
                from: account,
                "gas": 900000,
                "chainId": 3,
                "gasPrice": web3.utils.toWei('14.1','Gwei')
              })

              contract.methods.createCareer(job,business,work,startDay,finishDay).send(
                  transaction,
                  (error,result)=>{
                      if(error){
                        console.log('hahah why not')
                      }
                      else{
                        waitForReceipt(result, function(){
                            console.log(result)
                            var newUrl = "https://ropsten.etherscan.io/tx/" + result
                            $("#rec_url").attr("href", newUrl)
                            $("#rec_url").text(result)
                            }
                        )
                      }
                  }
              );
            });
    }
}
    </script>

</head>
<body id="page-top">
  <div class="container-fluid">
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark probootstrap-navbar-dark">
      <div class="container-fluid">
        <!-- <a class="navbar-brand" href="index.html">Health</a> -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#probootstrap-nav" aria-controls="probootstrap-nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
  
        <div class="collapse navbar-collapse" id="probootstrap-nav">
            <a class="navbar-brand js-scroll-trigger" href="/">SEBAKO</a>
          <ul class="navbar-nav ml-auto">
                  {% if user.is_active %}
                  <li class="nav-item"><a class="nav-link js-scroll-trigger" style="font-weight:bold;" href="/accounts/logout" style="font-family: 'Noto Sans KR', sans-serif; font-weight : bold; font-size : 30px">
                    로그아웃</a></li>
                  <li class="nav-item"><a class="nav-link js-scroll-trigger" style="font-weight:bold;" href="javascript:history.back();" style="font-family: 'Noto Sans KR', sans-serif; font-weight : bold; font-size : 10px">
                    내 정보</a></li>
                  {% else %}
                  <li class="nav-item"><a class="nav-link js-scroll-trigger" style="font-weight:bold;" href="/accounts/login" style="font-family: 'Noto Sans KR', sans-serif; font-weight : bold; font-size : 10px">
                    로그인</a></li>
                  {% endif %}
          </ul>
        </div>
      </div>
     </nav>

  <br><br><br>
  <section class="mb-5" style="margin-top: 50px">
    <div class="container">
      <div class="row">
        <div class="col-md-5 mb-2">
          <h1 class="display-4" style="font-family: 'Noto Sans KR', sans-serif; font-weight : 700; font-size : 70px; line-height:140%">
            경력 등록</h1><br>
            <p class="display-6" style="font-family: 'Noto Sans KR', sans-serif; font-weight : 500; font-size : 20px; line-height:140%">
			현재 검증가능 기관들 목록 : {% for data in datas %}{{data.1}} &nbsp</p>{%endfor%}<br>

        </div>
      </div>
    </div>
  </section>
  <section class="probootstrap-services">
    <div class="container">
      <div class="row no-gutters">
        <div class="col-md-3 pb-5 probootstrap-aside-stretch-left probootstrap-inside">
          <div class="mb-4 pt-5">
            <h2 class="h1" style="font-family: 'Noto Sans KR', sans-serif; font-weight : 500; font-size : 40px; line-height:140%">
              Let's register</h2>
            <ul class="list-unstyled probootstrap-light mb-4">
              <li class="h5" style="font-family: 'Noto Sans KR', sans-serif; font-weight : 400; font-size : 24px; line-height:140%; color:white;">
                지금까지의 경력을 한눈에</li>
              <li class="h5" style="font-family: 'Noto Sans KR', sans-serif; font-weight : 200; font-size : 20px; line-height:140%; color:white;">
                이더리움 네트워크에 저장되어 <br>안전하게 저장됩니다</li>
                <h2 class="h1" style="font-family: 'Noto Sans KR', sans-serif; font-weight : 500; font-size : 40px; line-height:140%">
              WARNING</h2>
            <ul class="list-unstyled probootstrap-light mb-4">
              <li class="h5" style="font-family: 'Noto Sans KR', sans-serif; font-weight : 200; font-size : 20px; line-height:140%; color:white;">
                  한번 등록한 정보는 이후에 삭제 및 수정이 어렵습니다</li>
                <br>
                <li><a href="/singlepage/{{profile.pk}}">Go Back</a></li>
            </ul>
          </div>
        </div>
    <div class="col-md-9 pl-md-5 pb-5 pl-0 probootstrap-inside">
        <h1 class="mt-4 mb-4" style="font-family: 'Noto Sans KR', sans-serif; font-weight : 500; font-size : 24px;">
          경력의 세부내용을 입력해주세요 :)</h1>
        <div class="row">
            <div class="col-md-12">
                <div   class="probootstrap-form">
                    <div class="form-group col-md-5" style="padding-left:0px;">
                      <input type="text" class="form-control" name="job" id="job" placeholder="직무를 입력해주세요">
                    </div>
                    <div class="form-group col-md-5" style="padding-left:0px;">
                      <input type="text" class="form-control"name="business" id="business" placeholder="회사/장소를 입력해주세요">
                    </div>
                    <div class="form-group col-md-5" style="padding-left:0px;">
                      <input type="text" id="work" name="work" class="form-control" placeholder="담당한 업무 내용을 입력해주세요">
                    </div>
                    <div class="form-group col-md-5" style="padding-left:0px;">
                      <input type="date" id="startDay" name="startDay" class="form-control" placeholder="시작일을 입력해주세요 ex) 2019.01.01">
                    </div>
                    <div class="form-group col-md-5" style="padding-left:0px;">
                        <input type="date" id="finishDay" name="finishDay" class="form-control" placeholder="종료일을 입력해주세요 ex) 2021.12.31">
                    </div>
                    <div class="form-group col-md-5" style="padding-left:0px;">
                      <input type="submit" class="btn btn-primary" value="등록하기" onclick="append()" style="margin-top: 40px; font-family: 'Noto Sans KR', sans-serif; font-weight : 400; font-size:16px">
                    </div>
                  </div>
                  <div class="container" style="margin-bottom: 100px; margin-left:-18px; ">
                    <h2 id="receipt" style="font-family: 'Noto Sans KR', sans-serif; font-weight : 500; font-size : 24px;">
                      등록하기 버튼을 누르면 경력이 블록체인에 등록됩니다<br>등록이 완료되면 아래에 링크가 생성됩니다</h2>
                    <a id="rec_url" href="" style="font-size: 20px"></a>
                </div>
            </div>
        </div>
    </div>
    </section>
<!-- Bootstrap core JS-->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Third party plugin JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
<!-- Core theme JS-->
<!--web3 JS-->
<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.36/dist/web3.min.js" integrity="sha256-nWBTbvxhJgjslRyuAKJHK+XcZPlCnmIAAMixz6EefVk=" crossorigin="anonymous"></script>
<script src="{% static 'js/web3auth.js' %}"></script>
</body>
</html>